{% extends "base.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Manage Holidays</h1>
</div>

<div class="form-container mb-4">
    <h4>Add New Holiday</h4>
    <form action="{{ url_for('add_record', table_name='holidays') }}" method="POST">
        <div class="row">
            <div class="col-md-4 mb-3">
                <label for="holiday_date" class="form-label">Date <span class="text-danger">*</span></label>
                <input type="date" class="form-control datepicker" id="holiday_date" name="date" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="holiday_name" class="form-label">Holiday Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="holiday_name" name="name" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="holiday_type" class="form-label">Type <span class="text-danger">*</span></label>
                <select class="form-select" id="holiday_type" name="holiday_type" required>
                    <option value="">-- Select Type --</option>
                    <option value="National">National</option>
                    <option value="University">University</option>
                    <option value="Exam">Exam</option>
                    <option value="Break">Break</option>
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="affects_timetable" class="form-label">Affects Timetable?</label>
                <select class="form-select" id="affects_timetable" name="affects_timetable">
                    <option value="1">Yes</option>
                    <option value="0">No</option>
                </select>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Add Holiday</button>
    </form>
</div>

<div class="table-container">
    <h4>Existing Holidays</h4>
    <div class="table-responsive">
        <table id="holidaysTable" class="table table-striped table-hover compact">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Date</th>
                    <th>Name</th>
                    <th>Type</th>
                    <th>Affects Timetable</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for holiday in holidays %}
                <tr>
                    <td>{{ holiday.holiday_id }}</td>
                    <td>{{ holiday.date }}</td>
                    <td>{{ holiday.name }}</td>
                    <td>{{ holiday.holiday_type }}</td>
                    <td>{{ 'Yes' if holiday.affects_timetable else 'No' }}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-btn"
                                data-table="holidays"
                                data-pk="holiday_id"
                                data-pk-value="{{ holiday.holiday_id }}">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <a href="{{ url_for('delete_record', table_name='holidays', primary_key='holiday_id', primary_value=holiday.holiday_id) }}"
                           class="btn btn-sm btn-danger delete-btn">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $('#holidaysTable').DataTable({
            "paging": true, "searching": true, "ordering": true, "info": true, "responsive": true
        });

        // Override generic refreshTableData for this page to just reload
        window.refreshTableData = function() {
            window.location.reload();
        };
    });
</script>
{% endblock %}
