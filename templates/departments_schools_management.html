{% extends "base1.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Manage Departments & Schools</h1>
</div>

<div class="form-container mb-4">
    <h4>Add New School</h4>
    <form action="{{ url_for('add_record', table_name='schools') }}" method="POST">
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="school_name" class="form-label">School Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="school_name" name="name" required>
            </div>
            <div class="col-md-6 mb-3">
                <label for="school_abbr" class="form-label">Abbreviation</label>
                <input type="text" class="form-control" id="school_abbr" name="abbrevation">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Add School</button>
    </form>
</div>

<div class="form-container mb-4">
    <h4>Add New Department</h4>
    <form action="{{ url_for('add_record', table_name='departments') }}" method="POST">
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="school_id_dept" class="form-label">School <span class="text-danger">*</span></label>
                <select class="form-select" id="school_id_dept" name="school_id" required>
                    <option value="">-- Select School --</option>
                    {% for school in schools %}
                        <option value="{{ school.school_id }}">{{ school.name }} ({{ school.abbrevation }})</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="department_name" class="form-label">Department Name <span class="text-danger">*</span></label>
                <input type="text" class="form-control" id="department_name" name="name" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Add Department</button>
    </form>
</div>

<div class="table-container mb-4">
    <h4>Existing Schools</h4>
    <div class="table-responsive">
        <table id="schoolsTable" class="table table-striped table-hover compact">
            <thead>
                <tr>
                    <th>School ID</th>
                    <th>Name</th>
                    <th>Abbreviation</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for school in schools %}
                <tr>
                    <td>{{ school.school_id }}</td>
                    <td>{{ school.name }}</td>
                    <td>{{ school.abbrevation }}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-btn"
                                data-table="schools"
                                data-pk="school_id"
                                data-pk-value="{{ school.school_id }}">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <a href="{{ url_for('delete_record', table_name='schools', primary_key='school_id', primary_value=school.school_id) }}"
                           class="btn btn-sm btn-danger delete-btn">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="table-container">
    <h4>Existing Departments</h4>
    <div class="table-responsive">
        <table id="departmentsTable" class="table table-striped table-hover compact">
            <thead>
                <tr>
                    <th>Department ID</th>
                    <th>School</th>
                    <th>Department Name</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for department in departments %}
                <tr>
                    <td>{{ department.department_id }}</td>
                    <td>{{ department.school_name }} ({{ department.school_abbr }})</td>
                    <td>{{ department.name }}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-btn"
                                data-table="departments"
                                data-pk="department_id"
                                data-pk-value="{{ department.department_id }}">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <a href="{{ url_for('delete_record', table_name='departments', primary_key='department_id', primary_value=department.department_id) }}"
                           class="btn btn-sm btn-danger delete-btn">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $('#schoolsTable').DataTable({
            "paging": true, "searching": true, "ordering": true, "info": true, "responsive": true
        });
        $('#departmentsTable').DataTable({
            "paging": true, "searching": true, "ordering": true, "info": true, "responsive": true
        });

        // Placeholder for refresh function if needed for AJAX updates on this page
        window.refreshTableData = function() {
            window.location.reload(); // Simple reload for now
        };
    });
</script>
{% endblock %}
