{% extends "base.html" %}

{% block content %}
<div class="form-container">
    <h1>Edit Record - {{ table_name }}</h1>
    <a href="{{ url_for('table_view', table_name=table_name) }}" class="btn btn-secondary mb-3">Back to Table</a>

    <form method="POST" action="{{ url_for('edit_row', table_name=table_name) }}">
        <input type="hidden" name="primary_key" value="{{ primary_key }}">
        <input type="hidden" name="primary_value" value="{{ row[primary_key] }}">

        <div class="row">
            {% for column, value in row.items() if column != primary_key %}
            <div class="col-md-6 mb-3">
                <label for="{{ column }}" class="form-label">{{ column | replace('_', ' ') | capitalize }}</label>
                {% if column in referenced_tables %}
                <select name="{{ column }}" class="form-select">
                    <option value="">-- Select {{ referenced_tables[column]['table'] | replace('_', ' ') }} --</option>
                    {% for option in referenced_tables[column]['values'] %}
                    <option value="{{ option.id }}" {% if value == option.id %}selected{% endif %}>{{ option.name }}</option>
                    {% endfor %}
                </select>
                {% elif column in ['is_active', 'has_lab', 'term_end_exam', 'is_internal_only', 'is_current', 'affects_timetable', 'is_rescheduled', 'is_lab_session', 'seen'] %}
                <select name="{{ column }}" class="form-select">
                    <option value="1" {% if value == 1 %}selected{% endif %}>Yes</option>
                    <option value="0" {% if value == 0 %}selected{% endif %}>No</option>
                </select>
                {% elif 'date' in column %}
                <input type="date" name="{{ column }}" class="form-control" value="{{ value if value is not none else '' }}">
                {% elif 'time' in column and not 'timestamp' in column %}
                <input type="time" name="{{ column }}" class="form-control" value="{{ value if value is not none else '' }}">
                {% else %}
                <input type="text" name="{{ column }}" class="form-control" value="{{ value if value is not none else '' }}">
                {% endif %}
            </div>
            {% endfor %}
        </div>

        <div class="mt-4">
            <button type="button" class="btn btn-secondary" onclick="window.history.back()">Cancel</button>
            <button type="submit" class="btn btn-primary">Save Changes</button>
        </div>
    </form>
</div>
{% endblock %}