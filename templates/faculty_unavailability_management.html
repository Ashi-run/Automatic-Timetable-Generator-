{% extends "base1.html" %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Manage Faculty Unavailability</h1>
</div>

<div class="form-container mb-4">
    <h4>Add Faculty Unavailability Slot</h4>
    <form action="{{ url_for('add_record', table_name='faculty_unavailability') }}" method="POST">
        <div class="row">
            <div class="col-md-6 mb-3">
                <label for="faculty_id_unavail" class="form-label">Faculty <span class="text-danger">*</span></label>
                <select class="form-select" id="faculty_id_unavail" name="faculty_id" required>
                    <option value="">-- Select Faculty --</option>
                    {% for faculty in faculties %}
                        <option value="{{ faculty.user_id }}">{{ faculty.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6 mb-3">
                <label for="day_of_week" class="form-label">Day of Week <span class="text-danger">*</span></label>
                <select class="form-select" id="day_of_week" name="day_of_week" required>
                    <option value="">-- Select Day --</option>
                    <option value="Mon">Monday</option>
                    <option value="Tue">Tuesday</option>
                    <option value="Wed">Wednesday</option>
                    <option value="Thu">Thursday</option>
                    <option value="Fri">Friday</option>
                    <option value="Sat">Saturday</option>
                    <option value="Sun">Sunday</option>
                </select>
            </div>
            <div class="col-md-4 mb-3">
                <label for="start_time" class="form-label">Start Time <span class="text-danger">*</span></label>
                <input type="time" class="form-control" id="start_time" name="start_time" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="end_time" class="form-label">End Time <span class="text-danger">*</span></label>
                <input type="time" class="form-control" id="end_time" name="end_time" required>
            </div>
            <div class="col-md-4 mb-3">
                <label for="reason" class="form-label">Reason</label>
                <input type="text" class="form-control" id="reason" name="reason" placeholder="e.g., Meeting, Research, Personal">
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Add Unavailability</button>
    </form>
</div>

<div class="table-container">
    <h4>Existing Faculty Unavailability</h4>
    <div class="table-responsive">
        <table id="unavailabilityTable" class="table table-striped table-hover compact">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Faculty Name</th>
                    <th>Day</th>
                    <th>Start Time</th>
                    <th>End Time</th>
                    <th>Reason</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for unavail in unavailabilities %}
                <tr>
                    <td>{{ unavail.id }}</td>
                    <td>{{ unavail.faculty_name }}</td>
                    <td>{{ unavail.day_of_week }}</td>
                    <td>{{ unavail.start_time }}</td>
                    <td>{{ unavail.end_time }}</td>
                    <td>{{ unavail.reason if unavail.reason else 'N/A' }}</td>
                    <td>
                        <button class="btn btn-sm btn-warning edit-btn"
                                data-table="faculty_unavailability"
                                data-pk="id"
                                data-pk-value="{{ unavail.id }}">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <a href="{{ url_for('delete_record', table_name='faculty_unavailability', primary_key='id', primary_value=unavail.id) }}"
                           class="btn btn-sm btn-danger delete-btn">
                            <i class="bi bi-trash"></i> Delete
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    $(document).ready(function() {
        $('#unavailabilityTable').DataTable({
            "paging": true, "searching": true, "ordering": true, "info": true, "responsive": true
        });

        // Override generic refreshTableData for this page to just reload
        window.refreshTableData = function() {
            window.location.reload();
        };
    });
</script>
{% endblock %}
